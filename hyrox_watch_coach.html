<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>HYROX Watch Coach ‚Äî v13.1 (GPS Permission + Pause Metrics)</title>
<style>
  :root{
    --bg:#000; --ink:#fff; --muted:#9aa3ad;
    --btn-blue:#2563eb;
    --btn-green:#16a34a;
    --btn-green-dark:#0f5132;
    --btn-gray:#374151;
    --btn-purple:#7c3aed;
    --btn-red:#dc2626;
    --btn-yellow:#fde047;
    --pace-green:#10ff9c; --pace-yellow:#ffe45e; --pace-orange:#ff8a3d; --pace-red:#ff3b30;
    --go-green:#22c55e;
    --rest-red:#ff3b30;
    --info-run:#22c55e;
    --info-class:#60a5fa;
    --info-rest:#9ca3af;
    --info-hyrox:#f59e0b;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system, SF Pro Text, Inter, Roboto, Arial}
  .wrap{padding:12px 14px 120px}
  .card{border-radius:20px;padding:14px;margin-bottom:14px}
  .label{font-size:14px;color:var(--muted)}
  .big{font-weight:900;font-variant-numeric:tabular-nums}
  .pace{font-size:60px;line-height:1.05}
  .pace .unit{font-size:.33em; margin-left:6px; vertical-align:baseline; font-weight:800}
  .goal{font-size:18px;color:var(--muted)}
  .timer{font-size:28px;font-weight:900}
  .workhead{font-size:22px;font-weight:900}
  .desc{font-size:18px; color:#b0b8c3; margin-top:6px; line-height:1.3}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  .row-full{display:grid;grid-template-columns:1fr;gap:14px}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
  .kv{display:flex;align-items:center;justify-content:space-between;padding:6px 0}
  .hidden{display:none}
  .btn{width:100%;border:none;border-radius:20px;color:#fff;font-weight:800;font-size:34px;padding:24px 18px;display:flex;align-items:center;justify-content:center;gap:10px}
  .btn:active{transform:scale(0.98)}
  .btn-blue{background:var(--btn-blue)}
  .btn-green{background:var(--btn-green)}
  .btn-green-dark{background:var(--btn-green-dark)}
  .btn-gray{background:var(--btn-gray)}
  .btn-purple{background:var(--btn-purple)}
  .btn-red{background:var(--btn-red)}
  .btn-yellow{background:var(--btn-yellow); color:#1a1a1a}
  .sticky-lap{position:fixed; left:14px; right:14px; bottom:14px; z-index:50;}
  .p-green{color:var(--pace-green)} .p-yellow{color:var(--pace-yellow)}
  .p-orange{color:var(--pace-orange)} .p-red{color:var(--pace-red)}
  .switch{position:relative; width:80px; height:40px; background:#222; border-radius:999px;}
  .thumb{position:absolute; width:36px; height:36px; border-radius:50%; top:2px; left:2px; background:#777; transition:all .2s}
  .switch.on{background:#14532d}
  .switch.on .thumb{left:42px; background:#22c55e}
  .overlay{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:99; background:var(--go-green)}
  .overlay.show{display:flex}
  .go{font-size:12vh; font-weight:900; color:#fff; text-shadow:0 2px 0 rgba(0,0,0,.15)}
  .dow{font-size:18px; color:var(--muted); padding:8px 12px; border-radius:12px; background:#0b0b0b}
  .title{font-size:20px; font-weight:900; color:#cbd5e1; margin-bottom:8px}
  .info-line{font-size:22px; font-weight:900}
  .tag-run{color:var(--info-run)}
  .tag-class{color:var(--info-class)}
  .tag-rest{color:var(--info-rest)}
  .tag-hyrox{color:var(--info-hyrox)}
  #pausedBlock{margin-top:8px}
  #pausedBlock .metric{display:flex; align-items:flex-end; gap:8px}
  #pausedBlock .label-sm{font-size:14px; color:#94a3b8; font-weight:800}
  #pausedBlock .val{font-size:40px; font-weight:900}
  #gpsStatus{font-size:14px; color:#9aa3ad; margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="label">Pace</div>
    <div id="pace" class="big pace">
      <span id="paceVal">--:--</span><span id="paceUnit" class="unit">/km</span>
    </div>
    <div id="pausedBlock" class="hidden">
      <div class="metric"><span class="label-sm">FAST ‚â•5s</span> <span id="fast5" class="val mono">--:--</span></div>
      <div class="metric"><span class="label-sm">AVG (no rest)</span> <span id="avgAll" class="val mono">--:--</span></div>
    </div>
    <div class="goal">Goal <span id="goal">--:--/km</span></div>
  </div>

  <div id="runTools" class="card">
    <div class="kv">
      <div class="label">Timer</div>
      <div><span id="timerBox" class="timer mono">00:00.0</span></div>
    </div>
    <div class="kv">
      <div class="label">Lap / Rep</div>
      <div class="mono" style="font-size:30px;font-weight:900">
        <span id="lapBox">0/0</span> <span style="opacity:.6">‚Ä¢</span> <span id="repBox">0/0</span>
      </div>
    </div>
    <div class="row" style="margin-top:12px">
      <button id="btnStart" class="btn btn-green">‚ñ∂Ô∏é</button>
      <button id="btnReset" class="btn btn-gray" aria-label="Reset">‚Ü∫</button>
    </div>

    <!-- GPS permission row -->
    <div id="gpsRow" class="row-full" style="margin-top:10px">
      <button id="btnGPS" class="btn btn-blue">üìç Enable GPS</button>
      <div id="gpsStatus">GPS: not requested</div>
    </div>
  </div>

  <div class="card">
    <div class="title">Workout Info</div>
    <div class="desc" id="wDesc">Your full 6-week BFT + Run plan is loaded here.</div>
  </div>
</div>

<div class="sticky-lap" id="lapBar">
  <button id="btnLap" class="btn btn-blue">‚ûï LAP +1</button>
</div>

<div class="overlay" id="goOverlay"><div class="go">GO!</div></div>

<script>
/* simplified init */
const btnGPS=document.getElementById('btnGPS');
const gpsStatus=document.getElementById('gpsStatus');
let geoWatchId=null;

function setGPSStatus(msg){gpsStatus.textContent=`GPS: ${msg}`;}
function requestGPSOnce(){
  if(!navigator.geolocation){setGPSStatus('not supported');return;}
  setGPSStatus('requesting‚Ä¶');
  navigator.geolocation.getCurrentPosition(
    pos=>{setGPSStatus(`ok (¬±${Math.round(pos.coords.accuracy||0)} m)`);startGPSWatch();},
    err=>{const map={1:'denied',2:'unavailable',3:'timeout'};setGPSStatus(map[err.code]||`error ${err.code}`);},
    {enableHighAccuracy:true,maximumAge:0,timeout:10000}
  );
}
function startGPSWatch(){
  if(geoWatchId!=null||!navigator.geolocation)return;
  geoWatchId=navigator.geolocation.watchPosition(
    pos=>{setGPSStatus
